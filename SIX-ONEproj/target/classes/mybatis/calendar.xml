<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 매퍼파일의 완전한 경로 : xml생략 -->
<mapper namespace="mybatis.calendar">
	
	<select id="calendarSelectList" resultType="calendarDTO">
		select calendar_no,start_date as"START" ,end_date+1 end,cal.type,background_color,cal.id,cal.routine_no,cal.play_no,exe.exercise_name title,play.count count from calendar cal join play_exe play on cal.play_no = play.play_no join exercise exe on play.exercise_no = exe.exercise_no
	</select>
	
	<select id="calendarSelectListRoutine" resultType="calendarDTO">
		select calendar_no,start_date as"START" ,end_date+1 end,cal.type,background_color,cal.id,cal.routine_no,cal.play_no,exe.exercise_name title,goal_count count from calendar cal join routine rou on cal.routine_no = rou.routine_no join rou_exe rx on rou.routine_no = rx.routine_no join exercise exe on rx.exercise_no = exe.exercise_no
	</select>
	
	
	<update id="calendarUpdate" parameterType="java.util.Map">
		update calendar set start_date=#{start}, end_date=#{end} where calendar_no=#{calendarNo}
	</update>
	
	<delete id="calendarDelete" parameterType="java.util.Map">
		delete calendar where calendar_no=#{calendarNo}
	</delete>
	
	<insert id="calendarInsert" parameterType="java.util.Map">
	insert all 
	into play_exe values(SEQ_PLAY_EXE.nextval,#{count},sysdate,#{username},(select exercise_no from exercise where exercise_name = #{title})) 
	into calendar values(SEQ_CALENDAR.nextval,#{start},#{end},'전신',#{backgroundColor},#{username},null,SEQ_PLAY_EXE.currval) select * from dual
	</insert>
	
	<update id="calendarUpdateOne" parameterType="java.util.Map">
		update calendar set start_date=#{start}, end_date=#{end},type='전신',background_color=#{backgroundColor} where calendar_no=#{calendarNo}
	
	</update>
	
	<update id="calendarUpdateOneExe" parameterType="java.util.Map">
		UPDATE play_exe e
   		SET e.count = #{count} , e.exercise_no = (select exercise_no from exercise where exercise_name = #{title})
 		WHERE EXISTS (SELECT 0 FROM calendar c WHERE c.play_no = e.play_no and c.calendar_no=#{calendarNo})
	</update>
	
	
	
	
	
	
	
	
	
</mapper>